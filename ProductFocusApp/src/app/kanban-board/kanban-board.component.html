<div class="margin-for-navs mid-nav">
  <div
    style="
      display: inline-block;
      vertical-align: top;
      margin: 0 10px;
      padding-top: 15px;
    "
  >
    Filters
  </div>
  <div style="display: inline-block; vertical-align: top; margin: 0 10px">
    <mat-form-field>
      <mat-label>Sprint</mat-label>
      <mat-select [(value)]="selectedSprint.name">
        <mat-option
          *ngFor="let sprint of allSprint"
          (click)="selectSprint(sprint)"
          [value]="sprint.name"
          >{{ sprint.name }}</mat-option
        >
      </mat-select>
    </mat-form-field>
  </div>
  <div style="display: inline-block; vertical-align: top; margin: 0 10px">
    <mat-form-field>
      <mat-label>Assigned To</mat-label>
      <mat-select
        multiple
        [(ngModel)]="selectedUserIds"
        (selectionChange)="setKanbanBoard()"
      >
        <mat-option *ngFor="let user of organizationUser" [value]="user.id">{{
          user.name
        }}</mat-option>
      </mat-select>
    </mat-form-field>
  </div>
  <div style="display: inline-block; height: 57px;">
    <div style="display: grid; align-items: center; height: 100%;">
      <mat-radio-group aria-label="Select an option">
        <mat-radio-button value="isKanbanMode" [checked]="isKanbanMode" (change)="changeMode(true)">Board View</mat-radio-button>
        <mat-radio-button value="!isKanbanMode" [checked]="!isKanbanMode" (change)="changeMode(false)">Scrum View</mat-radio-button>
      </mat-radio-group>
    </div>
  </div>
  <div class="d-inline-block" style="position: absolute; right: 30px;">
    <div ngbDropdown class="d-inline-block float_right" placement="bottom-right" style="position: static;">
      <i class="fa fa-cog fa-2x mt-3" id="settingsDropDown" ngbDropdownToggle></i>
      <div ngbDropdownMenu aria-labelledby="settingsDropDown">
        <button ngbDropdownItem (click)="openPopup(manageModuleContent)">
          Manage Modules
        </button>
        <button ngbDropdownItem (click)="openPopup(manageSprintContent, 'lg')">
          Manage Sprint
        </button>
      </div>
    </div>
  </div>
  <div *ngIf="!sprintExist" class="d-inline-block" style="position: absolute; right: 70px; margin-top: 20px;">
    <div style="display: inline; box-shadow: 2px 2px; border: 1px solid black;">
      Add a sprint here.
    </div>
    <i class="fa fa-arrow-right mt-1"></i>
  </div>
</div>
<div *ngIf="!error"
  class="margin-for-navs"
>
  <app-board-view *ngIf="isKanbanMode" [is-loading]="isLoading" [kanban-board]="kanbanBoard" (changed)="setKanbanBoard()" [selected-sprint]="selectedSprint"></app-board-view>
  <app-scrum-view *ngIf="!isKanbanMode" [is-loading]="isLoading" [kanban-board]="kanbanBoard" (changed)="updateChanges($event)" [selected-sprint]="selectedSprint"></app-scrum-view>
</div>
<ng-template #manageModuleContent let-modal>
  <div class="modal-header">
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <ul class="list-group">
      <li class="list-group-item" *ngFor="let module of modules">
        <div class="module">{{ module.name }}</div>
        <!-- <i class="fa fa-stop-circle float-right" data-toggle="tooltip" data-placement="top" title="Discontinue"></i> -->
      </li>
      <li class="list-group-item">
        <div class="add-module">
          <i
            *ngIf="!moduleAddView"
            (click)="moduleAddView = true"
            class="fa fa-plus"
          >
            Add Module</i
          >
          <div *ngIf="moduleAddView">
            <form #addModuleForm="ngForm" (ngSubmit)="addModule()">
              <input
                type="text"
                class="form-control"
                style="display: inline-block; vertical-align: middle"
                [(ngModel)]="moduleName"
                #module="ngModel"
                name="module"
                (keyup.enter)="addModule()"
                placeholder="Enter module name"
                required
                minlength="4"
              />
              <button
                [disabled]="!enabledAdding || addModuleForm.invalid"
                type="submit"
                class="btn good-btn"
                style="
                  display: inline-block;
                  vertical-align: middle;
                  margin: 0 5px;
                "
              >
                Add
              </button>
              <i
                *ngIf="enabledAdding"
                (click)="moduleAddView = false"
                class="fa fa-times"
                id="cancel-task"
                style="display: inline-block; vertical-align: middle"
              ></i>
              <div
                *ngIf="module.invalid && (module.dirty || module.touched)"
                class="text-danger"
              >
                <div *ngIf="module.errors?.required">Name is required.</div>
                <div *ngIf="module.errors?.minlength">
                  Name should be atleast 4 characters long.
                </div>
              </div>
            </form>
          </div>
        </div>
      </li>
    </ul>
  </div>
</ng-template>

<ng-template #manageSprintContent let-modal>
  <div class="modal-header">
    <button
      type="button"
      class="close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    >
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <!-- <div *ngFor="let item of [1,2,3]">
      <app-switch-text-textarea [title]="'R6-Sprint '+item"></app-switch-text-textarea>
    </div> -->
    <form [formGroup]="sprintForm" (ngSubmit)="addSprint()">
      <div class="add-sprint">
        <i
          *ngIf="!sprintAddView"
          (click)="sprintAddView = true"
          class="fa fa-plus"
          style="cursor: pointer"
        >
          Add Sprint</i
        >
        <div style="text-align: center">
          <div *ngIf="sprintAddView">
            <div
              style="
                font-size: large;
                transform: translateX(-185px);
                margin-bottom: 20px;
              "
            >
              <i class="fa fa-bolt"></i>
              New Sprint
            </div>
            <div style="transform: translateX(-213px)">
              Name<span style="color: red">*</span>
            </div>
            <input
              [attr.disabled]="isSprintAdding?'':null"
              type="text"
              [(ngModel)]="sprintName"
              name="sprintname"
              class="form-control"
              style="display: inline-block; width: 475px"
              placeholder="Enter Sprint Name"
              required
              maxlength="50"
              pattern="^[a-zA-Z0-9]+[a-zA-Z0-9\s\-_]*$"
              formControlName="name"
            />
            <div
              *ngIf="
                sprintValidate.invalid && (sprintValidate.dirty || !sprintValidate.untouched)
              "
            >
              <div
                class="text-danger"
                style="transform: translateX(-155px)"
                *ngIf="sprintForm.controls.name.errors?.required"
              >
                Please Enter Sprint Name.
              </div>
              <div class="text-danger" style="transform: translateX(-155px);" *ngIf="sprintForm.controls.name.errors?.maxlength">
                Only 50 characters are allowed.
              </div>
              <div
                class="text-danger"
                style="transform: translateX(-48px)"
                *ngIf="sprintForm.controls.name.errors?.pattern"
              >
                Only spaces, '-', '_' and alphanumaric characters are allowed.
              </div>
            </div>

            <div style="transform: translateX(-195px)">
              <div style="display: inline-block">
                Start<span style="color: red">*</span>
              </div>
              <div
                style="display: inline-block; transform: translateX(190px)"
              >
                End<span style="color: red">*</span>
              </div>
            </div>
            <ngb-datepicker
              #dp
              (dateSelect)="onDateSelection($event)"
              [displayMonths]="2"
              [dayTemplate]="t"
              outsideDays="hidden"
              name="sprintdates"
              formControlName="dates"
            >
            </ngb-datepicker>

            <div *ngIf="sprintValidate.invalid">
              <div
                class="text-danger"
                style="transform: translateX(-131px)"
                *ngIf="sprintForm.controls.dates.errors?.dateNotChosen">
                Please select start and end dates.
              </div>
            </div>
            <ng-template #t let-date let-focused="focused">
              <span
                class="custom-day"
                [class.focused]="focused"
                [class.range]="isRange(date)"
                [class.faded]="isHovered(date) || isInside(date)"
                (mouseenter)="hoveredDate = date"
                (mouseleave)="hoveredDate = null"
              >
                {{ date.day }}
              </span>
            </ng-template>
            <div style="transform: translateX(170px)">
              <button
                [disabled]="sprintForm.invalid || !enabledAdding"
                class="btn good-btn"
                type="submit"
              >
              <div *ngIf="isSprintAdding" class="spinner-border spinner-border-sm" role="status">
                <span class="sr-only">Loading...</span>
              </div>
                {{isSprintAdding?"Adding":"Add"}}
              </button>
              <button
                class="btn reject-btn"
                (click)="sprintAddView = false"
                id="cancel-task"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      </div>
    </form>
    <div class="mb-2">
      <div class="table-responsive-sm">
        <table class="table">
          <thead>
            <tr style="color: var(--gray)">
              <th scope="col">Name</th>
              <th scope="col">Sprint Dates</th>
              <!-- <th scope="col">Edit</th> -->
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let sprint of allSprint">
              <td>
                <span>{{ sprint.name }}</span>
              </td>
              <td>
                <span
                  >{{ sprint.startDate | date: "shortDate" }} -
                  {{ sprint.endDate | date: "shortDate" }}</span
                >
              </td>
              <!-- <td>
                <i class="fa fa-edit"></i>
              </td> -->
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</ng-template>
<div *ngIf="!!error">
  <app-error [error]="error"></app-error>
</div>